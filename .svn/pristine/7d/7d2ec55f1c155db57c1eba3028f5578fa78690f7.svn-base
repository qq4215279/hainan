package com.gobestsoft.mamage.moudle.system.service;

import com.gobestsoft.common.modular.mst.dao.MstOrganizationDao;
import com.gobestsoft.common.modular.system.dao.DeptDao;
import com.gobestsoft.common.modular.system.dao.MsgDao;
import com.gobestsoft.common.modular.system.mapper.DeptMapper;
import com.gobestsoft.common.modular.system.model.SysMsg;
import com.gobestsoft.core.reids.RedisUtils;
import com.gobestsoft.core.util.DateUtil;
import com.baomidou.mybatisplus.plugins.Page;

import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import javax.annotation.Resource;
import java.util.Date;
import java.util.List;

/**
 * 消息服务
 *
 * @author li
 * @date 
 */
@Service
@Transactional
public class MsgService {
	
	@Resource
	MsgDao msgDao;

    @Resource
    DeptMapper deptMapper;

    @Resource
    DeptDao deptDao;

    @Resource
    MstOrganizationDao mstOrganizationDao;

    @Autowired
    protected RedisUtils redisUtils;

    //工会组织树级别 （0：中国海南； 1：50个局级单位；2: 分公司；3: 项目部）
    private final static Integer[] LEVEL = {1, 2, 3};
    
    /**
     * 插入一条消息
     * @param toDeptId 推送组织ID
     * @param isopen    是否推送
     * @param content  消息内容
     * @param type     消息类型：0：建会审批。1：入会审批。
     * @param 
     */
    public void insertMsg(Integer toDeptId
     	   				 ,String isOpen
     	   				 ,String content
     	   				 ,String type
     	   				 ) {
    	SysMsg sysMsg = new SysMsg();
    	sysMsg.setToDeptId(toDeptId);
    	sysMsg.setIsOpen(isOpen);
    	sysMsg.setContent(content);
    	sysMsg.setType(type);
    	sysMsg.setCreateTime(DateUtil.getAllTime());
    	msgDao.insert(sysMsg);
    }

    /**
     * sysmsg条件查询
     */
    public List<SysMsg> msgList(Page<SysMsg> page,
//                                              ,Integer status,
//                                              String account,
//                                              String begDate,
//                                              String endDate,
////                                              String userId,
                                              String type,
                                              Integer deptId
                                              ){
        List<SysMsg> resultList = msgDao.msgList(page, deptId,type);
        for (SysMsg sysMsg : resultList) {
        	if (StringUtils.isNoneBlank(sysMsg.getCreateTime()) ) {
        		sysMsg.setCreateTime(DateUtil.parseAndFormat(sysMsg.getCreateTime(), "yyyyMMddHHmmss", "yyyy-MM-dd HH:mm"));
            }
		}
        return resultList;
    }

}
